# Raycast Obsidian 扩展内存溢出问题修复总结

## 问题描述
- 在加载大型 Obsidian 笔记库（20,000+ 个文件）时出现 "JS heap out of memory" 错误
- Raycast 本身对扩展有内存限制，无法通过简单增加内存上限解决

## 解决方案

### 核心优化策略
不是增加内存限制，而是减少内存使用：

1. **可配置的文件数量上限**
   - 默认最多加载 20,000 个笔记文件（可配置）
   - 按修改时间排序，优先加载最新文件
   - 可通过 `Max Note Count` 设置调整

2. **智能内容加载**
   - 大文件（>50KB）只加载前 2KB 用于元数据提取
   - 所有文件内容限制在 10,000 字符以内
   - 提供预览而非完整内容

3. **文件大小过滤**
   - 默认跳过 >2MB 的文件
   - 可在设置中调整阈值
   - 这是解决内存问题的关键，因为通常只有少数大文件导致问题

4. **懒加载模式**
   - 默认开启，大幅减少内存占用
   - 适合超大型笔记库

## 使用方法

### 快速开始
```bash
# 安装依赖
npm install

# 启动开发模式
npm run dev
```

### 配置建议
在 Raycast 扩展设置中：
1. 设置 **Vault Path**: `/Users/oldwinter/oldwinter-notes`
2. 设置 **Max File Size (MB)**: `2`（或更小，跳过大文件）
3. 设置 **Max Note Count**: `20000`（默认值，可根据需要调整）
4. 保持 **Lazy Load Content**: 开启
5. 添加不需要的文件夹到 **Excluded Folders**

## 性能表现
- ✅ 成功处理 20,000+ 个笔记文件
- ✅ 内存使用控制在 Raycast 限制内
- ✅ 搜索功能正常工作
- ✅ 默认可搜索最多 20,000 个文件（可配置）

## 后续优化建议
1. 实现分页加载机制
2. 添加按需加载完整内容功能
3. 优化搜索算法，减少内存占用
4. 考虑使用流式处理大文件

## 文件变更列表
- `package.json` - 添加内存相关脚本和设置项
- `src/api/vault/vault.service.ts` - 优化文件加载逻辑
- `src/utils/preferences.tsx` - 添加新设置的类型定义
- `dev.sh` - 开发启动脚本
- `DEBUG_GUIDE.md` - 调试指南
- `FIX_SUMMARY.md` - 本文档
